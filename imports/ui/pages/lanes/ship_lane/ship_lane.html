<template name="ship_lane">
  {{#if lane}}
    <h1>Ship to lane: {{lane.name}}</h1>
    <h2>Let's review.  Ready to ship?</h2>
    <a href="/lanes/{{lane.name}}/edit" class="button secondary hollow edit-lane">Edit this lane</a>
  {{else}}
    <h1>That lane doesn't exist.</h1>
  {{/if}}
    <a href="/lanes" class="button hollow show-lanes">Back to Lanes</a>

  {{#if lane.shipment_active}}
    <a href="/lanes/{{lane.name}}/ship/{{lane.latest_shipment}}" class="button">View Active Shipment</a>
    <button class="button warning reset-shipment">Reset Shipment</button>
  {{else}}
    <button class="button success start-shipment">Start Shipment</button>
  {{/if}}

  {{#if lane}}
    <h3>Harbor: {{lane.type}}</h3>
    <figure class="work-preview exit-code code-{{exit_code}} {{active}}">
      <figcaption class="work-caption">Work Preview</figcaption>
      <section>
        {{{work_preview}}}
      </section>
    </figure>
  {{/if}}

  {{#if lane.followup}}
  <h4><a target=_blank href="/lanes/{{followup_name lane}}/ship">Followup: {{followup_name lane}}</a></h4>
  {{/if}}

  <h2>Shipping Log: Last {{shipping_log_amount_shown}} shipments</h2>
  <ul>
    {{#if lane}}
      {{#if lane.shipment_active}}
        <li><a href="/lanes/{{lane.name}}/ship/{{lane.latest_shipment}}" class="button tiny warning">Shipment currently in progress...</a></li>
      {{/if}}
    {{/if}}
    {{#each lane "history"}}
      {{#if this.salvaged}}
        <li>
          <a href="/lanes/{{lane.name}}/ship/{{this.manifest.shipment_start_date}}" class="button tiny alert hollow">
            Salvaged on {{pretty_date this.finished}}, {{duration}} duration
          </a>
        </li>
      {{else}}
        <li>
          <a href="/lanes/{{lane.name}}/ship/{{this.manifest.shipment_start_date}}" class="button tiny hollow">
            Shipped on {{pretty_date this.actual}}, finished on {{pretty_date this.finished}}, {{duration}} duration
          </a>
        </li>
      {{/if}}
    {{/each}}
  </ul>
</template>
